<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting the OMOP CDM vocabularies • CodelistGenerator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting the OMOP CDM vocabularies">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CodelistGenerator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a01_GettingOmopCdmVocabularies.html">Getting the OMOP CDM vocabularies</a></li>
    <li><a class="dropdown-item" href="../articles/a02_ExploreCDMvocabulary.html">Exploring the OMOP CDM vocabulary tables</a></li>
    <li><a class="dropdown-item" href="../articles/a03_GenerateCandidateCodelist.html">Generate a candidate codelist</a></li>
    <li><a class="dropdown-item" href="../articles/a04_GenerateVocabularyBasedCodelist.html">Generating vocabulary based codelists for medications</a></li>
    <li><a class="dropdown-item" href="../articles/a04b_icd_codes.html">Generating vocabulary based codelists for conditions</a></li>
    <li><a class="dropdown-item" href="../articles/a05_ExtractCodelistFromJSONfile.html">Extract codelists from JSON files</a></li>
    <li><a class="dropdown-item" href="../articles/a06_CreateSubsetsFromCodelist.html">Compare, subset or stratify codelists</a></li>
    <li><a class="dropdown-item" href="../articles/a07_RunCodelistDiagnostics.html">Codelist diagnostics</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav"></ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Getting the OMOP CDM vocabularies</h1>
            
      

      <div class="d-none name"><code>a01_GettingOmopCdmVocabularies.Rmd</code></div>
    </div>

    
    
<p>When working with the CodelistGenerator we normally have two options
of how to interact with the OMOP CDM vocabulary tables.</p>
<p>The first is to connect to a “live” database with patient data in the
OMOP CDM format. As part of this OMOP CDM dataset we will have a version
of vocabularies that corresponds to the concepts being used in the
patient records we have in the various clinical tables. This is useful
in that we will be working with the same vocabularies that are being
used for clinical records in this dataset. However, if working on a
study with multiple data partners we should take note that other data
partners may be using different vocabulary versions.</p>
<p>The second option is to create a standalone database with just a set
of OMOP CDM vocabulary tables. This is convenient because we can choose
whichever version and vocabularies we want. However, we will need to
keep in mind that this can differ to the version used for a particular
dataset.</p>
<div class="section level2">
<h2 id="connect-to-an-existing-omop-cdm-database">Connect to an existing OMOP CDM database<a class="anchor" aria-label="anchor" href="#connect-to-an-existing-omop-cdm-database"></a>
</h2>
<p>If you already have access to a database with data in the OMOP CDM
format, you can use CodelistGenerator by first creating a cdm reference
which will include the vocabulary tables.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CodelistGenerator/">CodelistGenerator</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/requireEunomia.html" class="external-link">requireEunomia</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, dbdir <span class="op">=</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/eunomiaDir.html" class="external-link">eunomiaDir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">cdmFromCon</a></span><span class="op">(</span><span class="va">db</span>, </span>
<span>                  cdmSchema <span class="op">=</span> <span class="st">"main"</span>, </span>
<span>                  writeSchema <span class="op">=</span> <span class="st">"main"</span>, </span>
<span>                  writePrefix <span class="op">=</span> <span class="st">"cg_"</span><span class="op">)</span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (duckdb) of Synthea</span> <span style="color: #00BBBB;">────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">omop tables:</span> person, observation_period, visit_occurrence, visit_detail,</span></span>
<span><span class="co">#&gt; condition_occurrence, drug_exposure, procedure_occurrence, device_exposure,</span></span>
<span><span class="co">#&gt; measurement, observation, death, note, note_nlp, specimen, fact_relationship,</span></span>
<span><span class="co">#&gt; location, care_site, provider, payer_plan_period, cost, drug_era, dose_era,</span></span>
<span><span class="co">#&gt; condition_era, metadata, cdm_source, concept, vocabulary, domain,</span></span>
<span><span class="co">#&gt; concept_class, concept_relationship, relationship, concept_synonym,</span></span>
<span><span class="co">#&gt; concept_ancestor, source_to_concept_map, drug_strength</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">cohort tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other tables:</span> -</span></span></code></pre></div>
<p>We can see that we know have various OMOP CDM vocabulary tables we
can work with.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">concept</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 10</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.2.1 [unknown@Linux 6.8.0-1021-azure:R 4.4.3//tmp/RtmpK7PHF3/file227323e540e.duckdb]</span></span>
<span><span class="co">#&gt; $ concept_id       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 35208414<span style="color: #949494;">, </span>1118088<span style="color: #949494;">, </span>40213201<span style="color: #949494;">, </span>1557272<span style="color: #949494;">, </span>4336464<span style="color: #949494;">, </span>429588…</span></span>
<span><span class="co">#&gt; $ concept_name     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Gastrointestinal hemorrhage, unspecified"<span style="color: #949494;">, </span>"celecoxi…</span></span>
<span><span class="co">#&gt; $ domain_id        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Condition"<span style="color: #949494;">, </span>"Drug"<span style="color: #949494;">, </span>"Drug"<span style="color: #949494;">, </span>"Drug"<span style="color: #949494;">, </span>"Procedure"<span style="color: #949494;">, </span>"Pr…</span></span>
<span><span class="co">#&gt; $ vocabulary_id    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "ICD10CM"<span style="color: #949494;">, </span>"RxNorm"<span style="color: #949494;">, </span>"CVX"<span style="color: #949494;">, </span>"RxNorm"<span style="color: #949494;">, </span>"SNOMED"<span style="color: #949494;">, </span>"SNOM…</span></span>
<span><span class="co">#&gt; $ concept_class_id <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4-char billing code"<span style="color: #949494;">, </span>"Branded Drug"<span style="color: #949494;">, </span>"CVX"<span style="color: #949494;">, </span>"Ingred…</span></span>
<span><span class="co">#&gt; $ standard_concept <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>"S"<span style="color: #949494;">, </span>"S"<span style="color: #949494;">, </span>"S"<span style="color: #949494;">, </span>"S"<span style="color: #949494;">, </span>"S"<span style="color: #949494;">, </span>"S"<span style="color: #949494;">, </span>"S"<span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span>"S"<span style="color: #949494;">, </span>"…</span></span>
<span><span class="co">#&gt; $ concept_code     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "K92.2"<span style="color: #949494;">, </span>"213469"<span style="color: #949494;">, </span>"33"<span style="color: #949494;">, </span>"46041"<span style="color: #949494;">, </span>"232717009"<span style="color: #949494;">, </span>"76601…</span></span>
<span><span class="co">#&gt; $ valid_start_date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2007-01-01<span style="color: #949494;">, </span>1970-01-01<span style="color: #949494;">, </span>2008-12-01<span style="color: #949494;">, </span>1970-01-01<span style="color: #949494;">, </span>1970…</span></span>
<span><span class="co">#&gt; $ valid_end_date   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2099-12-31<span style="color: #949494;">, </span>2099-12-31<span style="color: #949494;">, </span>2099-12-31<span style="color: #949494;">, </span>2099-12-31<span style="color: #949494;">, </span>2099…</span></span>
<span><span class="co">#&gt; $ invalid_reason   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">N</span>…</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">concept_relationship</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.2.1 [unknown@Linux 6.8.0-1021-azure:R 4.4.3//tmp/RtmpK7PHF3/file227323e540e.duckdb]</span></span>
<span><span class="co">#&gt; $ concept_id_1     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 192671<span style="color: #949494;">, </span>1118088<span style="color: #949494;">, </span>1569708<span style="color: #949494;">, </span>35208414<span style="color: #949494;">, </span>35208414<span style="color: #949494;">, </span>4016235…</span></span>
<span><span class="co">#&gt; $ concept_id_2     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 35208414<span style="color: #949494;">, </span>44923712<span style="color: #949494;">, </span>35208414<span style="color: #949494;">, </span>192671<span style="color: #949494;">, </span>1569708<span style="color: #949494;">, </span>450118…</span></span>
<span><span class="co">#&gt; $ relationship_id  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Mapped from"<span style="color: #949494;">, </span>"Mapped from"<span style="color: #949494;">, </span>"Subsumes"<span style="color: #949494;">, </span>"Maps to"<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ valid_start_date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1970-01-01<span style="color: #949494;">, </span>1970-01-01<span style="color: #949494;">, </span>2016-03-25<span style="color: #949494;">, </span>1970-01-01<span style="color: #949494;">, </span>2016…</span></span>
<span><span class="co">#&gt; $ valid_end_date   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2099-12-31<span style="color: #949494;">, </span>2099-12-31<span style="color: #949494;">, </span>2099-12-31<span style="color: #949494;">, </span>2099-12-31<span style="color: #949494;">, </span>2099…</span></span>
<span><span class="co">#&gt; $ invalid_reason   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span><span style="color: #949494;">, </span><span style="color: #BB0000;">NA</span></span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">concept_ancestor</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.2.1 [unknown@Linux 6.8.0-1021-azure:R 4.4.3//tmp/RtmpK7PHF3/file227323e540e.duckdb]</span></span>
<span><span class="co">#&gt; $ ancestor_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 4180628<span style="color: #949494;">, </span>4179141<span style="color: #949494;">, </span>21500574<span style="color: #949494;">, </span>21505770<span style="color: #949494;">, </span>2150396…</span></span>
<span><span class="co">#&gt; $ descendant_concept_id    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 313217<span style="color: #949494;">, </span>4146173<span style="color: #949494;">, </span>1118084<span style="color: #949494;">, </span>1119510<span style="color: #949494;">, </span>40162522<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ min_levels_of_separation <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 5<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>5<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>…</span></span>
<span><span class="co">#&gt; $ max_levels_of_separation <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 6<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>6<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>4<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>2<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>0<span style="color: #949494;">, </span>…</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">concept_synonym</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.2.1 [unknown@Linux 6.8.0-1021-azure:R 4.4.3//tmp/RtmpK7PHF3/file227323e540e.duckdb]</span></span>
<span><span class="co">#&gt; $ concept_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 964261<span style="color: #949494;">, </span>1322184<span style="color: #949494;">, </span>441267<span style="color: #949494;">, </span>1718412<span style="color: #949494;">, </span>4336464<span style="color: #949494;">, </span>410212…</span></span>
<span><span class="co">#&gt; $ concept_synonym_name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "cyanocobalamin 5000 MCG/ML Injectable Solution"<span style="color: #949494;">,</span>…</span></span>
<span><span class="co">#&gt; $ language_concept_id  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 4180186<span style="color: #949494;">, </span>4180186<span style="color: #949494;">, </span>4180186<span style="color: #949494;">, </span>4180186<span style="color: #949494;">, </span>4180186<span style="color: #949494;">, </span>4180…</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">drug_strength</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 12</span></span>
<span><span class="co">#&gt; Database: DuckDB v1.2.1 [unknown@Linux 6.8.0-1021-azure:R 4.4.3//tmp/RtmpK7PHF3/file227323e540e.duckdb]</span></span>
<span><span class="co">#&gt; $ drug_concept_id             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> </span></span>
<span><span class="co">#&gt; $ ingredient_concept_id       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> </span></span>
<span><span class="co">#&gt; $ amount_value                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ amount_unit_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> </span></span>
<span><span class="co">#&gt; $ numerator_value             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ numerator_unit_concept_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> </span></span>
<span><span class="co">#&gt; $ denominator_value           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ denominator_unit_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> </span></span>
<span><span class="co">#&gt; $ box_size                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> </span></span>
<span><span class="co">#&gt; $ valid_start_date            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> </span></span>
<span><span class="co">#&gt; $ valid_end_date              <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> </span></span>
<span><span class="co">#&gt; $ invalid_reason              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span></code></pre></div>
<p>It is important to remember that our results will be tied to the
vocabulary version used when this OMOP CDM database was created.
Moreover, we should also take note of which vocabularies were included.
A couple of CodelistGenerator utility functions can help us find this
information.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getVocabVersion.html">getVocabVersion</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "v5.0 18-JAN-19"</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getVocabularies.html">getVocabularies</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CVX"     "Gender"  "ICD10CM" "LOINC"   "NDC"     "None"    "RxNorm" </span></span>
<span><span class="co">#&gt; [8] "SNOMED"  "Visit"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-a-local-vocabulary-database">Create a local vocabulary database<a class="anchor" aria-label="anchor" href="#create-a-local-vocabulary-database"></a>
</h2>
<p>If you don’t have access to an OMOP CDM database or if you want to
work with a specific vocabulary version and set of vocabularies then you
can create your own vocabulary database.</p>
<div class="section level3">
<h3 id="download-vocabularies-from-athena">Download vocabularies from athena<a class="anchor" aria-label="anchor" href="#download-vocabularies-from-athena"></a>
</h3>
<p>Your first step will be to get the vocabulary tables for the OMOP
CDM. For this go to <a href="https://athena.ohdsi.org/" class="external-link uri">https://athena.ohdsi.org/</a>. From here you can, after
creating a free account, download the vocabularies. By default you will
be getting the latest version and a default set of vocabularies. You can
though choose to download an older version and expand your selection of
vocabularies. In general we would suggest to select all available
vocabularies.</p>
</div>
<div class="section level3">
<h3 id="create-a-duckdb-database">Create a duckdb database<a class="anchor" aria-label="anchor" href="#create-a-duckdb-database"></a>
</h3>
<p>After downloading the vocabularies you will have a set of csvs (along
with a tool to add the CPT-4 codes if you wish). To quickly create a
duckdb vocab database you could use the following code. Here, after
pointing to the unzipped folder containg the csvs, we’ll read each table
into memory and write them to a duckdb database which we’ll save in the
same folder. We’ll also add an empty person and observation period table
so that you can create a cdm reference at the end.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/omopgenerics/" class="external-link">omopgenerics</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">vocab_folder</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="op">(</span><span class="op">)</span> <span class="co"># add path to directory</span></span>
<span></span>
<span><span class="co"># read in files</span></span>
<span><span class="va">concept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_delim</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">vocab_folder</span>, <span class="st">"CONCEPT.csv"</span><span class="op">)</span>,</span>
<span>                      <span class="st">"\t"</span>,</span>
<span>                      escape_double <span class="op">=</span> <span class="cn">FALSE</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">concept_relationship</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_delim</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">vocab_folder</span>, <span class="st">"CONCEPT_RELATIONSHIP.csv"</span><span class="op">)</span>,</span>
<span>                                   <span class="st">"\t"</span>,</span>
<span>                                   escape_double <span class="op">=</span> <span class="cn">FALSE</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">concept_ancestor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_delim</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">vocab_folder</span>, <span class="st">"CONCEPT_ANCESTOR.csv"</span><span class="op">)</span>,</span>
<span>                               <span class="st">"\t"</span>,</span>
<span>                               escape_double <span class="op">=</span> <span class="cn">FALSE</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">concept_synonym</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_delim</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">vocab_folder</span>, <span class="st">"CONCEPT_SYNONYM.csv"</span><span class="op">)</span>,</span>
<span>                              <span class="st">"\t"</span>,</span>
<span>                              escape_double <span class="op">=</span> <span class="cn">FALSE</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">vocabulary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_delim</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="va">vocab_folder</span>, <span class="st">"VOCABULARY.csv"</span><span class="op">)</span>, <span class="st">"\t"</span>,</span>
<span>                         escape_double <span class="op">=</span> <span class="cn">FALSE</span>, trim_ws <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to duckdb</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu">here</span><span class="op">(</span><span class="va">vocab_folder</span>,<span class="st">"vocab.duckdb"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"concept"</span>, <span class="va">concept</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"concept_relationship"</span>, <span class="va">concept_relationship</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"concept_ancestor"</span>, <span class="va">concept_ancestor</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"concept_synonym"</span>, <span class="va">concept_synonym</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"vocabulary"</span>, <span class="va">vocabulary</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># add empty person and observation period tables</span></span>
<span><span class="va">person_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/omopColumns.html" class="external-link">omopColumns</a></span><span class="op">(</span><span class="st">"person"</span><span class="op">)</span></span>
<span><span class="va">person</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">person_cols</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">person</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">person_cols</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"person"</span>, <span class="va">person</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">observation_period_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/omopColumns.html" class="external-link">omopColumns</a></span><span class="op">(</span><span class="st">"observation_period"</span><span class="op">)</span></span>
<span><span class="va">observation_period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">observation_period_cols</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">observation_period</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">observation_period_cols</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"observation_period"</span>, <span class="va">observation_period</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span></code></pre></div>
<p>Now we could create a cdm reference to our OMOP CDM vocabulary
database.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu">here</span><span class="op">(</span><span class="va">vocab_folder</span>,<span class="st">"vocab.duckdb"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">cdmFromCon</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"main"</span>, <span class="st">"main"</span>, cdmName <span class="op">=</span> <span class="st">"vocabularise"</span>, .softValidation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This vocabulary only database can be then used for the various
functions for identifying codes of interest. However, as it doesn’t
contain patient-level records it won’t be relevant for functions
summarising the use of codes, etc. Here we have shown how to make a
local duckdb database, but a similar approach could also be used for
other database management systems.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edward Burn, Xihang Chen, Nuria Mercade-Besora.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
